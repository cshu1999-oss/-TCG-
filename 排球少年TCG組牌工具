<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阿仁 x 排球少年TCG組牌工具</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            background-image: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #e53935, #e35d5b);
            color: white;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .channel-link {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 15px;
            color: white;
        }
        
        .channel-link a {
            color: #ffeb3b;
            text-decoration: none;
            font-weight: 600;
        }
        
        .channel-link a:hover {
            text-decoration: underline;
        }
        
        .main-content {
            display: flex;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .cards-section {
            flex: 3;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
        }
        
        .deck-section {
            flex: 2;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #e53935;
            color: #e53935;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title span {
            font-size: 1rem;
            color: #666;
            font-weight: normal;
        }
        
        .card-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .type-btn {
            padding: 8px 16px;
            background: #f1f1f1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .type-btn.active {
            background: #e53935;
            color: white;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            flex: 1;
        }
        
        .card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            border-color: #e53935;
        }
        
        .card.dragging {
            opacity: 0.7;
        }
        
        /* 卡片庫圖片容器 - 完整顯示不裁切 */
        .card-image-container {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            border-radius: 8px;
            background: #eee;
            overflow: visible;
            padding: 10px;
            min-height: 280px;
        }
        
        .card-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        .card-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: #e53935;
            font-size: 0.95rem;
            word-break: break-word;
            width: 100%;
        }
        
        .card-type {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 12px;
            display: inline-block;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .card-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .add-btn {
            background: #4caf50;
            color: white;
        }
        
        .deck-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 18px;
            background: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .deck-count {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e53935;
        }
        
        .deck-types {
            font-size: 1rem;
            color: #666;
        }
        
        .deck-area {
            border: 2px dashed #e53935;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            background: #fff9f9;
            transition: all 0.3s;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .deck-area.drag-over {
            background: #ffeaea;
            border-color: #c62828;
        }
        
        .deck-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .deck-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            border: 1px solid #eee;
        }
        
        /* 牌組圖片容器 - 完整顯示不裁切 */
        .deck-card-image-container {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            border-radius: 6px;
            background: #eee;
            overflow: visible;
            padding: 5px;
            min-height: 140px;
        }
        
        .deck-card-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        .deck-card-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 0.85rem;
        }
        
        .deck-card-type {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 8px;
        }
        
        .deck-card-count {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .count-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        
        .remove-btn {
            background: #f44336;
            color: white;
        }
        
        .count-number {
            font-weight: bold;
            color: #e53935;
            min-width: 20px;
            text-align: center;
        }
        
        .empty-deck {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-style: italic;
            font-size: 1.1rem;
            grid-column: 1 / -1;
        }
        
        .deck-stats {
            margin-top: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .stats-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #e53935;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
        }
        
        .stat-value {
            font-weight: 600;
            color: #e53935;
        }
        
        .download-section {
            margin-top: 25px;
            text-align: center;
        }
        
        .download-btn {
            padding: 12px 24px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .download-btn:hover {
            background: #388e3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .download-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4caf50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .warning {
            background: #ff9800;
        }
        
        .error {
            background: #f44336;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .deck-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .card-type-selector {
                justify-content: center;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .channel-link {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>阿仁 x 排球少年TCG組牌工具</h1>
            <p class="subtitle">點擊或拖拽卡片添加到牌組！牌組最多40張，事件卡最多8張</p>
            <p class="channel-link">阿仁的頻道 : <a href="https://www.youtube.com/@c.shu1999" target="_blank">https://www.youtube.com/@c.shu1999</a></p>
        </header>
        
        <div class="main-content">
            <section class="cards-section">
                <h2 class="section-title">卡片庫 <span>點擊或拖拽卡片添加到牌組</span></h2>
                
                <div class="card-type-selector">
                    <button class="type-btn active" data-type="all">全部</button>
                    <button class="type-btn" data-type="karasuno">烏野高校</button>
                    <button class="type-btn" data-type="nekoma">音駒高校</button>
                    <button class="type-btn" data-type="aoba-johsai">青葉城西</button>
                    <button class="type-btn" data-type="fukurodani">梟谷高校</button>
                    <button class="type-btn" data-type="other">其他高校</button>
                    <button class="type-btn" data-type="event">事件</button>
                    <button class="type-btn" data-type="hvbp">HVBP</button>
                    <button class="type-btn" data-type="hvpr">HVPR</button>
                </div>
                
                <div class="cards-container" id="cards-container">
                    <!-- 卡片將由JavaScript動態生成 -->
                </div>
            </section>
            
            <section class="deck-section">
                <h2 class="section-title">我的牌組 <span id="deck-count">0/40</span></h2>
                
                <div class="deck-info">
                    <div class="deck-count">卡片數量: <span id="total-count">0</span>/40</div>
                    <div class="deck-types">事件卡: <span id="event-count">0</span>/8</div>
                </div>
                
                <div class="deck-area" id="deck-area">
                    <div class="deck-list" id="deck-list">
                        <div class="empty-deck">牌組目前是空的，請從左側添加卡片</div>
                    </div>
                </div>
                
                <div class="deck-stats">
                    <div class="stats-title">牌組統計</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">總卡片數:</span>
                            <span class="stat-value" id="stat-total">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">事件卡:</span>
                            <span class="stat-value" id="stat-event">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="download-section">
                    <button class="download-btn" id="download-btn" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        下載牌組圖片
                    </button>
                </div>
            </section>
        </div>
        
        <footer>
            <p>阿仁 x 排球少年TCG組牌工具 &copy; 2023 - 輕鬆構建您的專屬牌組</p>
        </footer>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // 預先內建的所有卡片數據 - 已修正為直接圖片連結
        const allCards = [
            // 烏野高校卡片
            { id: 1, name: "HV-D01-001", type: "karasuno", image: "https://i.ibb.co/7ttmMQY3/HV-D01-001.png" },
            { id: 2, name: "HV-D01-002", type: "karasuno", image: "https://i.ibb.co/Nn7R1Vhp/HV-D01-002.png" },
            { id: 3, name: "HV-D01-003", type: "karasuno", image: "https://i.ibb.co/XfpG6G32/HV-D01-003.png" },
            { id: 4, name: "HV-D01-004", type: "karasuno", image: "https://i.ibb.co/3yP2kPBt/HV-D01-004.png" },
            { id: 5, name: "HV-D01-005", type: "karasuno", image: "https://i.ibb.co/jPP5qQs4/HV-D01-005.png" },
            { id: 6, name: "HV-D01-006", type: "karasuno", image: "https://i.ibb.co/ZpTcFBH3/HV-D01-006.png" },
            { id: 7, name: "HV-D01-007", type: "karasuno", image: "https://i.ibb.co/Vpk2n4Yr/HV-D01-007.png" },
            { id: 8, name: "HV-D01-008", type: "karasuno", image: "https://i.ibb.co/W4ZckTB6/HV-D01-008.png" },
            { id: 9, name: "HV-D01-009", type: "karasuno", image: "https://i.ibb.co/93WxTRcc/HV-D01-009.png" },
            { id: 10, name: "HV-D01-010", type: "karasuno", image: "https://i.ibb.co/GQZBYqY5/HV-D01-010.png" },
            { id: 11, name: "HV-P01-001", type: "karasuno", image: "https://i.ibb.co/NbX52h6/HV-P01-001.png" },
            { id: 12, name: "HV-P01-002", type: "karasuno", image: "https://i.ibb.co/VYhDPHCK/HV-P01-002.png" },
            { id: 13, name: "HV-P01-002p", type: "karasuno", image: "https://i.ibb.co/Z47xSFx/HV-P01-002p.png" },
            { id: 14, name: "HV-P01-003", type: "karasuno", image: "https://i.ibb.co/tMWh6S8D/HV-P01-003.png" },
            { id: 15, name: "HV-P01-004", type: "karasuno", image: "https://i.ibb.co/3mtBt7MF/HV-P01-004.png" },
            { id: 16, name: "HV-P01-004p", type: "karasuno", image: "https://i.ibb.co/FbHqH2JW/HV-P01-004p.png" },
            { id: 17, name: "HV-P01-005", type: "karasuno", image: "https://i.ibb.co/xq8ytxDT/HV-P01-005.png" },
            { id: 18, name: "HV-P01-006", type: "karasuno", image: "https://i.ibb.co/yBNxWTpD/HV-P01-006.png" },
            { id: 19, name: "HV-P01-006p", type: "karasuno", image: "https://i.ibb.co/cch78CkC/HV-P01-006p.png" },
            { id: 20, name: "HV-P01-007", type: "karasuno", image: "https://i.ibb.co/J422XcR/HV-P01-007.png" },
            { id: 21, name: "HV-P01-008", type: "karasuno", image: "https://i.ibb.co/WW6sS2d8/HV-P01-008.png" },
            { id: 22, name: "HV-P01-008p", type: "karasuno", image: "https://i.ibb.co/C3xBP0Fg/HV-P01-008p.png" },
            { id: 23, name: "HV-P01-009", type: "karasuno", image: "https://i.ibb.co/F4FRjdwG/HV-P01-009.png" },
            { id: 24, name: "HV-P01-010", type: "karasuno", image: "https://i.ibb.co/7xZ98jSv/HV-P01-010.png" },
            { id: 25, name: "HV-P01-011", type: "karasuno", image: "https://i.ibb.co/Z6Mc8kzG/HV-P01-011.png" },
            { id: 26, name: "HV-P01-011p", type: "karasuno", image: "https://i.ibb.co/Fq4Dc3p7/HV-P01-011p.png" },
            { id: 27, name: "HV-P01-012", type: "karasuno", image: "https://i.ibb.co/w36X01M/HV-P01-012.png" },
            { id: 28, name: "HV-P01-012p", type: "karasuno", image: "https://i.ibb.co/zVmWWQfM/HV-P01-012p.png" },
            { id: 29, name: "HV-P01-013", type: "karasuno", image: "https://i.ibb.co/LDf3Xbmx/HV-P01-013.png" },
            { id: 30, name: "HV-P01-014", type: "karasuno", image: "https://i.ibb.co/d0cXVwDd/HV-P01-014.png" },
            { id: 31, name: "HV-P01-014p", type: "karasuno", image: "https://i.ibb.co/3YBJ5JXT/HV-P01-014p.png" },
            { id: 32, name: "HV-P01-015", type: "karasuno", image: "https://i.ibb.co/3y7HM51C/HV-P01-015.png" },
            { id: 33, name: "HV-P01-015p", type: "karasuno", image: "https://i.ibb.co/zWPDyLvK/HV-P01-015p.png" },
            { id: 34, name: "HV-P01-016", type: "karasuno", image: "https://i.ibb.co/XrsL2GV2/HV-P01-016.png" },

            // 音駒高校卡片
            { id: 35, name: "HV-D02-001", type: "nekoma", image: "https://i.ibb.co/SXxr2wLW/HV-D02-001.png" },
            { id: 36, name: "HV-D02-002", type: "nekoma", image: "https://i.ibb.co/1tYpTXSt/HV-D02-002.png" },
            { id: 37, name: "HV-D02-003", type: "nekoma", image: "https://i.ibb.co/PZNCTzfm/HV-D02-003.png" },
            { id: 38, name: "HV-D02-004", type: "nekoma", image: "https://i.ibb.co/rGMcP8ft/HV-D02-004.png" },
            { id: 39, name: "HV-D02-005", type: "nekoma", image: "https://i.ibb.co/ycyNZvxV/HV-D02-005.png" },
            { id: 40, name: "HV-D02-006", type: "nekoma", image: "https://i.ibb.co/nsRz6Kmn/HV-D02-006.png" },
            { id: 41, name: "HV-D02-007", type: "nekoma", image: "https://i.ibb.co/0jbwbQBs/HV-D02-007.png" },
            { id: 42, name: "HV-D02-008", type: "nekoma", image: "https://i.ibb.co/1JGyP0CG/HV-D02-008.png" },
            { id: 43, name: "HV-D02-009", type: "nekoma", image: "https://i.ibb.co/Ndqfxzh5/HV-D02-009.png" },
            { id: 44, name: "HV-D02-010", type: "nekoma", image: "https://i.ibb.co/mFBHwC05/HV-D02-010.png" },
            { id: 45, name: "HV-P01-017", type: "nekoma", image: "https://i.ibb.co/MyB9BWpV/HV-P01-017.png" },
            { id: 46, name: "HV-P01-018", type: "nekoma", image: "https://i.ibb.co/C573HrHm/HV-P01-018.png" },
            { id: 47, name: "HV-P01-018p", type: "nekoma", image: "https://i.ibb.co/8ghJ0MZL/HV-P01-018p.png" },
            { id: 48, name: "HV-P01-019", type: "nekoma", image: "https://i.ibb.co/rfsTZm0y/HV-P01-019.png" },
            { id: 49, name: "HV-P01-020", type: "nekoma", image: "https://i.ibb.co/ymW5V9r7/HV-P01-020.png" },
            { id: 50, name: "HV-P01-021", type: "nekoma", image: "https://i.ibb.co/vCbYZcY4/HV-P01-021.png" },
            { id: 51, name: "HV-P01-021p", type: "nekoma", image: "https://i.ibb.co/1Yn6rJw6/HV-P01-021p.png" },
            { id: 52, name: "HV-P01-022", type: "nekoma", image: "https://i.ibb.co/gZzm3btq/HV-P01-022.png" },
            { id: 53, name: "HV-P01-023", type: "nekoma", image: "https://i.ibb.co/fdXJgszG/HV-P01-023.png" },
            { id: 54, name: "HV-P01-023p", type: "nekoma", image: "https://i.ibb.co/3xKgPnj/HV-P01-023p.png" },
            { id: 55, name: "HV-P01-024", type: "nekoma", image: "https://i.ibb.co/vCZ0NSzn/HV-P01-024.png" },
            { id: 56, name: "HV-P01-025", type: "nekoma", image: "https://i.ibb.co/Q7D2ZcF3/HV-P01-025.png" },
            { id: 57, name: "HV-P01-026", type: "nekoma", image: "https://i.ibb.co/Pv8BvfKm/HV-P01-026.png" },
            { id: 58, name: "HV-P01-027", type: "nekoma", image: "https://i.ibb.co/rRWCnbxt/HV-P01-027.png" },
            { id: 59, name: "HV-P01-027p", type: "nekoma", image: "https://i.ibb.co/hJghy0nD/HV-P01-027p.png" },
            { id: 60, name: "HV-P01-028", type: "nekoma", image: "https://i.ibb.co/nssbTybc/HV-P01-028.png" },
            { id: 61, name: "HV-P01-029", type: "nekoma", image: "https://i.ibb.co/d0WmP1wh/HV-P01-029.png" },
            { id: 62, name: "HV-P01-029p", type: "nekoma", image: "https://i.ibb.co/pB9J58nY/HV-P01-029p.png" },
            { id: 63, name: "HV-P01-030", type: "nekoma", image: "https://i.ibb.co/67d2DJtV/HV-P01-030.png" },
            { id: 64, name: "HV-P01-031", type: "nekoma", image: "https://i.ibb.co/bRQDbBGM/HV-P01-031.png" },
            { id: 65, name: "HV-P01-032", type: "nekoma", image: "https://i.ibb.co/dJx0jfbF/HV-P01-032.png" },

            // 青葉城西卡片
            { id: 66, name: "HV-P01-033", type: "aoba-johsai", image: "https://i.ibb.co/8nm6VFDD/HV-P01-033.png" },
            { id: 67, name: "HV-P01-033p", type: "aoba-johsai", image: "https://i.ibb.co/p6wpBnrs/HV-P01-033p.png" },
            { id: 68, name: "HV-P01-034", type: "aoba-johsai", image: "https://i.ibb.co/TMGP1HNT/HV-P01-034.png" },
            { id: 69, name: "HV-P01-035", type: "aoba-johsai", image: "https://i.ibb.co/wFCpYzWB/HV-P01-035.png" },
            { id: 70, name: "HV-P01-035p", type: "aoba-johsai", image: "https://i.ibb.co/SwK5hFv5/HV-P01-035p.png" },
            { id: 71, name: "HV-P01-036", type: "aoba-johsai", image: "https://i.ibb.co/Nd93g56X/HV-P01-036.png" },
            { id: 72, name: "HV-P01-037", type: "aoba-johsai", image: "https://i.ibb.co/qM9Jm5Ys/HV-P01-037.png" },
            { id: 73, name: "HV-P01-038", type: "aoba-johsai", image: "https://i.ibb.co/ksZVk4R0/HV-P01-038.png" },
            { id: 74, name: "HV-P01-039", type: "aoba-johsai", image: "https://i.ibb.co/PZKHLtbS/HV-P01-039.png" },
            { id: 75, name: "HV-P01-040", type: "aoba-johsai", image: "https://i.ibb.co/7Ny8ZMdk/HV-P01-040.png" },
            { id: 76, name: "HV-P01-041", type: "aoba-johsai", image: "https://i.ibb.co/JwW8MZkp/HV-P01-041.png" },
            { id: 77, name: "HV-P01-042", type: "aoba-johsai", image: "https://i.ibb.co/DHgT8kPt/HV-P01-042.png" },

            // 梟谷高校卡片
            { id: 78, name: "HV-P01-043", type: "fukurodani", image: "https://i.ibb.co/XxCXGJ9h/HV-P01-043.png" },
            { id: 79, name: "HV-P01-043p", type: "fukurodani", image: "https://i.ibb.co/gsR8j9W/HV-P01-043p.png" },
            { id: 80, name: "HV-P01-044", type: "fukurodani", image: "https://i.ibb.co/mFY3BQtW/HV-P01-044.png" },
            { id: 81, name: "HV-P01-045", type: "fukurodani", image: "https://i.ibb.co/Wp78Vtv4/HV-P01-045.png" },
            { id: 82, name: "HV-P01-045p", type: "fukurodani", image: "https://i.ibb.co/pv3qNrwR/HV-P01-045p.png" },
            { id: 83, name: "HV-P01-046", type: "fukurodani", image: "https://i.ibb.co/rKthbfgW/HV-P01-046.png" },
            { id: 84, name: "HV-P01-047", type: "fukurodani", image: "https://i.ibb.co/fY6tgntJ/HV-P01-047.png" },
            { id: 85, name: "HV-P01-048", type: "fukurodani", image: "https://i.ibb.co/2rK27jn/HV-P01-048.png" },
            { id: 86, name: "HV-P01-049", type: "fukurodani", image: "https://i.ibb.co/Pzx6G8xK/HV-P01-049.png" },
            { id: 87, name: "HV-P01-050", type: "fukurodani", image: "https://i.ibb.co/fG8DWxTm/HV-P01-050.png" },
            { id: 88, name: "HV-P01-051", type: "fukurodani", image: "https://i.ibb.co/Lhkhmynw/HV-P01-051.png" },
            { id: 89, name: "HV-P01-052", type: "fukurodani", image: "https://i.ibb.co/60NcHS1Z/HV-P01-052.png" },

            // 其他高校卡片
            { id: 90, name: "HV-P01-053", type: "other", image: "https://i.ibb.co/XfCYXDc8/HV-P01-053.png" },
            { id: 91, name: "HV-P01-054", type: "other", image: "https://i.ibb.co/RG5ntMr6/HV-P01-054.png" },
            { id: 92, name: "HV-P01-054p", type: "other", image: "https://i.ibb.co/LMThswL/HV-P01-054p.png" },
            { id: 93, name: "HV-P01-055", type: "other", image: "https://i.ibb.co/d4fH1MSW/HV-P01-055.png" },
            { id: 94, name: "HV-P01-055p", type: "other", image: "https://i.ibb.co/9k1Y4Pmc/HV-P01-055p.png" },
            { id: 95, name: "HV-P01-056", type: "other", image: "https://i.ibb.co/9mJvd5DY/HV-P01-056.png" },
            { id: 96, name: "HV-P01-056p", type: "other", image: "https://i.ibb.co/93bpyd6j/HV-P01-056p.png" },
            { id: 97, name: "HV-P01-057", type: "other", image: "https://i.ibb.co/rfFdQxxr/HV-P01-057.png" },
            { id: 98, name: "HV-P01-058", type: "other", image: "https://i.ibb.co/YB02rc3P/HV-P01-058.png" },
            { id: 99, name: "HV-P01-059", type: "other", image: "https://i.ibb.co/3mqbLkP3/HV-P01-059.png" },
            { id: 100, name: "HV-P01-060", type: "other", image: "https://i.ibb.co/1Y8k9qYT/HV-P01-060.png" },
            { id: 101, name: "HV-P01-061", type: "other", image: "https://i.ibb.co/Rk2M185m/HV-P01-061.png" },
            { id: 102, name: "HV-P01-062", type: "other", image: "https://i.ibb.co/5hm60Gqb/HV-P01-062.png" },
            { id: 103, name: "HV-P01-063", type: "other", image: "https://i.ibb.co/TM9wRL3q/HV-P01-063.png" },
            { id: 104, name: "HV-P01-064", type: "other", image: "https://i.ibb.co/kgdKCskP/HV-P01-064.png" },
            { id: 105, name: "HV-P01-064p", type: "other", image: "https://i.ibb.co/x8c0ZGSt/HV-P01-064p.png" },
            { id: 106, name: "HV-P01-065", type: "other", image: "https://i.ibb.co/MxnHpFQ8/HV-P01-065.png" },
            { id: 107, name: "HV-P01-066", type: "other", image: "https://i.ibb.co/PZPn7ty5/HV-P01-066.png" },
            { id: 108, name: "HV-P01-066p", type: "other", image: "https://i.ibb.co/sp2ZP7gK/HV-P01-066p.png" },
            { id: 109, name: "HV-P01-067", type: "other", image: "https://i.ibb.co/fGpPJrvk/HV-P01-067.png" },
            { id: 110, name: "HV-P01-068", type: "other", image: "https://i.ibb.co/3yTFJySB/HV-P01-068.png" },
            { id: 111, name: "HV-P01-069", type: "other", image: "https://i.ibb.co/qMWRNYyt/HV-P01-069.png" },
            { id: 112, name: "HV-P01-071", type: "other", image: "https://i.ibb.co/pBHrBB7n/HV-P01-071.png" },
            { id: 113, name: "HV-P01-071p", type: "other", image: "https://i.ibb.co/m5fKMtCS/HV-P01-071p.png" },
            { id: 114, name: "HV-P01-072", type: "other", image: "https://i.ibb.co/ds3qR90h/HV-P01-072.png" },
            { id: 115, name: "HV-P01-073", type: "other", image: "https://i.ibb.co/Rpnxzx2B/HV-P01-073.png" },

            // 事件卡片
            { id: 116, name: "HV-D01-011", type: "event", image: "https://i.ibb.co/0j9qXKj5/HV-D01-011.png" },
            { id: 117, name: "HV-D01-012", type: "event", image: "https://i.ibb.co/QFCJ0SMC/HV-D01-012.png" },
            { id: 118, name: "HV-D02-011", type: "event", image: "https://i.ibb.co/VYpY8ktW/HV-D02-011.png" },
            { id: 119, name: "HV-D02-012", type: "event", image: "https://i.ibb.co/jPrvpb5D/HV-D02-012.png" },
            { id: 120, name: "HV-P01-074", type: "event", image: "https://i.ibb.co/gLLh57nH/HV-P01-074.png" },
            { id: 121, name: "HV-P01-074p", type: "event", image: "https://i.ibb.co/7LBcTG5/HV-P01-074p.png" },
            { id: 122, name: "HV-P01-075", type: "event", image: "https://i.ibb.co/03Xt96m/HV-P01-075.png" },
            { id: 123, name: "HV-P01-076", type: "event", image: "https://i.ibb.co/V05V9ZSb/HV-P01-076.png" },
            { id: 124, name: "HV-P01-077", type: "event", image: "https://i.ibb.co/CpfgfJnb/HV-P01-077.png" },
            { id: 125, name: "HV-P01-078", type: "event", image: "https://i.ibb.co/HTYm5vTj/HV-P01-078.png" },
            { id: 126, name: "HV-P01-078p", type: "event", image: "https://i.ibb.co/xSJjMLXg/HV-P01-078p.png" },
            { id: 127, name: "HV-P01-079", type: "event", image: "https://i.ibb.co/tT4Dd7xh/HV-P01-079.png" },
            { id: 128, name: "HV-P01-079p", type: "event", image: "https://i.ibb.co/dJHT5Z82/HV-P01-079p.png" },
            { id: 129, name: "HV-P01-080", type: "event", image: "https://i.ibb.co/gbrSfqJX/HV-P01-080.png" },
            { id: 130, name: "HV-P01-080p", type: "event", image: "https://i.ibb.co/3yLqwj1w/HV-P01-080p.png" },
            { id: 131, name: "HV-P01-081", type: "event", image: "https://i.ibb.co/VpC7cFcc/HV-P01-081.png" },
            { id: 132, name: "HV-P01-082", type: "event", image: "https://i.ibb.co/k2hXnzdN/HV-P01-082.png" },
            { id: 133, name: "HV-P01-083", type: "event", image: "https://i.ibb.co/PzGcks5g/HV-P01-083.png" },
            { id: 134, name: "HV-P01-084", type: "event", image: "https://i.ibb.co/SDd6dbNf/HV-P01-084.png" },
            { id: 135, name: "HV-P01-085", type: "event", image: "https://i.ibb.co/6RcvPR5z/HV-P01-085.png" },
            { id: 136, name: "HV-P01-086", type: "event", image: "https://i.ibb.co/nMcHXpsY/HV-P01-086.png" },
            { id: 137, name: "HV-P01-087", type: "event", image: "https://i.ibb.co/1G9432j8/HV-P01-087.png" },
            { id: 138, name: "HV-P01-088", type: "event", image: "https://i.ibb.co/R4N9899S/HV-P01-088.png" },
            { id: 139, name: "HV-P01-089", type: "event", image: "https://i.ibb.co/TxGkS01Y/HV-P01-089.png" },
            { id: 140, name: "HV-P01-090", type: "event", image: "https://i.ibb.co/4nsWwvpQ/HV-P01-090.png" },
            { id: 141, name: "HV-P01-091", type: "event", image: "https://i.ibb.co/jqPm3cs/HV-P01-091.png" },
            { id: 142, name: "HV-P01-092", type: "event", image: "https://i.ibb.co/DDmjJ523/HV-P01-092.png" },
            { id: 143, name: "HV-P01-093", type: "event", image: "https://i.ibb.co/C5WvDjmX/HV-P01-093.png" },

            // HVBP卡片
            { id: 144, name: "HVBP-001", type: "hvbp", image: "https://i.ibb.co/b5YW0Q1Z/HVBP-001.png" },
            { id: 145, name: "HVBP-002", type: "hvbp", image: "https://i.ibb.co/Lz2Q5Ytr/HVBP-002.png" },
            { id: 146, name: "HVBP-003", type: "hvbp", image: "https://i.ibb.co/nqtYSvRF/HVBP-003.png" },
            { id: 147, name: "HVBP-004", type: "hvbp", image: "https://i.ibb.co/6RvC3Hdy/HVBP-004.png" },
            { id: 148, name: "HVBP-005", type: "hvbp", image: "https://i.ibb.co/FbP9ZjVP/HVBP-005.png" },
            { id: 149, name: "HVBP-006", type: "hvbp", image: "https://i.ibb.co/BKF7ksBV/HVBP-006.png" },
            { id: 150, name: "HVBP-007", type: "hvbp", image: "https://i.ibb.co/JFrnnBRF/HVBP-007.png" },
            { id: 151, name: "HVBP-008", type: "hvbp", image: "https://i.ibb.co/0jnNhDvb/HVBP-008.png" },
            { id: 152, name: "HVBP-009", type: "hvbp", image: "https://i.ibb.co/9mq7KVzs/HVBP-009.png" },
            { id: 153, name: "HVBP-010", type: "hvbp", image: "https://i.ibb.co/gZScYWgT/HVBP-010.png" },
            { id: 154, name: "HVBP-011", type: "hvbp", image: "https://i.ibb.co/xtDLxdk4/HVBP-011.png" },
            { id: 155, name: "HVBP-012", type: "hvbp", image: "https://i.ibb.co/0jKXV2Hj/HVBP-012.png" },
            { id: 156, name: "HVBP-013", type: "hvbp", image: "https://i.ibb.co/RGvjy4VV/HVBP-013.png" },
            { id: 157, name: "HVBP-014", type: "hvbp", image: "https://i.ibb.co/hFwmTQd8/HVBP-014.png" },

            // HVPR卡片
            { id: 158, name: "HV-PR-001", type: "hvpr", image: "https://i.ibb.co/KpCbtjJ0/HV-PR-001.png" },
            { id: 159, name: "HV-PR-002", type: "hvpr", image: "https://i.ibb.co/fdYxhTbP/HV-PR-002.png" },
            { id: 160, name: "HV-PR-003", type: "hvpr", image: "https://i.ibb.co/nqtpk5DN/HV-PR-003.png" },
            { id: 161, name: "HV-PR-004", type: "hvpr", image: "https://i.ibb.co/ynDHGJ4C/HV-PR-004.png" },
            { id: 162, name: "HV-PR-005", type: "hvpr", image: "https://i.ibb.co/VpcPPMM1/HV-PR-005.png" },
            { id: 163, name: "HV-PR-006", type: "hvpr", image: "https://i.ibb.co/9k3fW2nq/HV-PR-006.png" },
            { id: 164, name: "HV-PR-007", type: "hvpr", image: "https://i.ibb.co/7tMXr5bR/HV-PR-007.png" },
            { id: 165, name: "HV-PR-008", type: "hvpr", image: "https://i.ibb.co/2whv9Tz/HV-PR-008.png" },
            { id: 166, name: "HV-PR-009", type: "hvpr", image: "https://i.ibb.co/GvWcnhzg/HV-PR-009.png" },
            { id: 167, name: "HV-PR-010", type: "hvpr", image: "https://i.ibb.co/n8kp9khQ/HV-PR-010.png" },
            { id: 168, name: "HV-PR-011", type: "hvpr", image: "https://i.ibb.co/bRKYW5LW/HV-PR-011.png" },
            { id: 169, name: "HV-PR-012", type: "hvpr", image: "https://i.ibb.co/RTvVWT5J/HV-PR-012.png" },
            { id: 170, name: "HV-PR-013", type: "hvpr", image: "https://i.ibb.co/j9zHJn2n/HV-PR-013.png" },
            { id: 171, name: "HV-PR-014", type: "hvpr", image: "https://i.ibb.co/DHnMstvF/HV-PR-014.png" },
            { id: 172, name: "HV-PR-015", type: "hvpr", image: "https://i.ibb.co/nM3290qW/HV-PR-015.png" }
        ];

        // 當前牌組
        let currentDeck = [];
        let currentCardType = 'all';
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderAllCards();
            setupEventListeners();
        });
        
        // 設置事件監聽器
        function setupEventListeners() {
            // 卡片類型篩選
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCardType = this.dataset.type;
                    renderAllCards();
                });
            });
            
            // 牌組區域拖拽事件
            const deckArea = document.getElementById('deck-area');
            deckArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            deckArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            deckArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const cardId = e.dataTransfer.getData('text/plain');
                if (cardId) {
                    const card = allCards.find(c => c.id == cardId);
                    if (card) {
                        addToDeck(card);
                    }
                }
            });
            
            // 下載按鈕
            document.getElementById('download-btn').addEventListener('click', downloadDeckImage);
        }
        
        // 渲染所有卡片
        function renderAllCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            
            let filteredCards = allCards;
            
            // 應用篩選
            if (currentCardType !== 'all') {
                filteredCards = allCards.filter(card => card.type === currentCardType);
            }
            
            // 渲染卡片
            filteredCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.id = card.id;
                cardElement.draggable = true;
                
                // 設置拖拽數據
                cardElement.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', card.id);
                    this.classList.add('dragging');
                });
                
                cardElement.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
                
                cardElement.innerHTML = `
                    <div class="card-image-container">
                        <img src="${card.image}" alt="${card.name}" class="card-image">
                    </div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-type">${getTypeText(card.type)}</div>
                    <div class="card-actions">
                        <button class="card-btn add-btn" data-id="${card.id}">+</button>
                    </div>
                `;
                
                // 點擊添加到牌組
                cardElement.querySelector('.add-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    addToDeck(card);
                });
                
                container.appendChild(cardElement);
            });
        }
        
        // 添加到牌組
        function addToDeck(card) {
            // 檢查牌組是否已滿
            if (currentDeck.length >= 40) {
                showNotification('牌組已滿！最多只能添加40張卡片。', 'error');
                return;
            }
            
            // 檢查事件卡數量限制
            if (card.type === 'event') {
                const eventCardCount = currentDeck.filter(c => c.type === 'event').length;
                if (eventCardCount >= 8) {
                    showNotification('事件卡最多只能放8張！', 'warning');
                    return;
                }
            }
            
            // 添加到牌組
            currentDeck.push({...card});
            
            // 更新UI
            updateDeckDisplay();
            showNotification(`已添加卡片: ${card.name}`, 'success');
        }
        
        // 從牌組中移除卡片
        function removeFromDeck(cardId) {
            const index = currentDeck.findIndex(card => card.id === cardId);
            if (index !== -1) {
                currentDeck.splice(index, 1);
                updateDeckDisplay();
            }
        }
        
        // 更新牌組顯示
        function updateDeckDisplay() {
            const deckList = document.getElementById('deck-list');
            const deckCount = document.getElementById('deck-count');
            const totalCount = document.getElementById('total-count');
            const eventCount = document.getElementById('event-count');
            const downloadBtn = document.getElementById('download-btn');
            
            // 計算事件卡數量
            const eventCardCount = currentDeck.filter(card => card.type === 'event').length;
            
            // 更新計數
            totalCount.textContent = currentDeck.length;
            eventCount.textContent = eventCardCount;
            deckCount.textContent = `${currentDeck.length}/40`;
            
            // 啟用或禁用下載按鈕
            downloadBtn.disabled = currentDeck.length === 0;
            
            // 更新牌組列表
            if (currentDeck.length === 0) {
                deckList.innerHTML = '<div class="empty-deck">牌組目前是空的，請從左側添加卡片</div>';
            } else {
                deckList.innerHTML = '';
                
                // 按卡片ID分組
                const groupedCards = {};
                currentDeck.forEach(card => {
                    if (!groupedCards[card.id]) {
                        groupedCards[card.id] = {
                            card: card,
                            count: 1
                        };
                    } else {
                        groupedCards[card.id].count++;
                    }
                });
                
                // 渲染牌組中的卡片
                Object.values(groupedCards).forEach(item => {
                    const deckCardElement = document.createElement('div');
                    deckCardElement.className = 'deck-card';
                    
                    deckCardElement.innerHTML = `
                        <div class="deck-card-image-container">
                            <img src="${item.card.image}" alt="${item.card.name}" class="deck-card-image">
                        </div>
                        <div class="deck-card-name">${item.card.name}</div>
                        <div class="deck-card-type">${getTypeText(item.card.type)}</div>
                        <div class="deck-card-count">
                            <button class="count-btn remove-btn" data-id="${item.card.id}">-</button>
                            <span class="count-number">${item.count}</span>
                            <button class="count-btn add-btn" data-id="${item.card.id}">+</button>
                        </div>
                    `;
                    
                    deckList.appendChild(deckCardElement);
                });
                
                // 添加按鈕的事件監聽器
                document.querySelectorAll('.deck-card .add-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cardId = parseInt(this.dataset.id);
                        const card = allCards.find(c => c.id === cardId);
                        if (card) addToDeck(card);
                    });
                });
                
                document.querySelectorAll('.deck-card .remove-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        removeFromDeck(parseInt(this.dataset.id));
                    });
                });
            }
            
            // 更新統計信息
            updateDeckStats();
        }
        
        // 更新牌組統計
        function updateDeckStats() {
            // 計算事件卡數量
            const eventCount = currentDeck.filter(card => card.type === 'event').length;
            
            document.getElementById('stat-total').textContent = currentDeck.length;
            document.getElementById('stat-event').textContent = eventCount;
        }
        
        // 下載牌組圖片
        function downloadDeckImage() {
            if (currentDeck.length === 0) {
                showNotification('牌組是空的，無法下載！', 'error');
                return;
            }
            
            showNotification('正在生成圖片，請稍候...', 'success');
            
            // 創建用於生成圖片的臨時容器
            const tempContainer = document.createElement('div');
            tempContainer.style.padding = '20px';
            tempContainer.style.background = 'white';
            tempContainer.style.maxWidth = '1000px';
            tempContainer.style.margin = '0 auto';
            
            // 添加標題
            const title = document.createElement('h2');
            title.textContent = '我的排球少年TCG牌組';
            title.style.textAlign = 'center';
            title.style.color = '#e53935';
            title.style.marginBottom = '20px';
            title.style.fontSize = '24px';
            tempContainer.appendChild(title);
            
            // 添加卡片網格 - 使用4列布局
            const cardsGrid = document.createElement('div');
            cardsGrid.style.display = 'flex';
            cardsGrid.style.flexWrap = 'wrap';
            cardsGrid.style.gap = '15px';
            cardsGrid.style.justifyContent = 'flex-start';
            
            // 按卡片ID分組
            const groupedCards = {};
            currentDeck.forEach(card => {
                if (!groupedCards[card.id]) {
                    groupedCards[card.id] = {
                        card: card,
                        count: 1
                    };
                } else {
                    groupedCards[card.id].count++;
                }
            });
            
            // 計算每行的卡片數量（最多4個）
            const cardsPerRow = 4;
            let currentRow = document.createElement('div');
            currentRow.style.display = 'flex';
            currentRow.style.width = '100%';
            currentRow.style.justifyContent = 'space-between';
            currentRow.style.marginBottom = '15px';
            
            // 添加卡片到網格 - 每行最多4個
            Object.values(groupedCards).forEach((item, index) => {
                const cardElement = document.createElement('div');
                cardElement.style.flex = '1';
                cardElement.style.minWidth = `calc(${100/cardsPerRow}% - 15px)`;
                cardElement.style.maxWidth = `calc(${100/cardsPerRow}% - 15px)`;
                cardElement.style.background = '#f9f9f9';
                cardElement.style.borderRadius = '8px';
                cardElement.style.padding = '10px';
                cardElement.style.textAlign = 'center';
                cardElement.style.border = '1px solid #eee';
                cardElement.style.display = 'flex';
                cardElement.style.flexDirection = 'column';
                cardElement.style.alignItems = 'center';
                
                // 卡片圖片 - 完整顯示不裁切
                const imgContainer = document.createElement('div');
                imgContainer.style.width = '100%';
                imgContainer.style.display = 'flex';
                imgContainer.style.alignItems = 'center';
                imgContainer.style.justifyContent = 'center';
                imgContainer.style.marginBottom = '8px';
                imgContainer.style.borderRadius = '6px';
                imgContainer.style.background = '#eee';
                imgContainer.style.overflow = 'visible';
                imgContainer.style.padding = '10px';
                imgContainer.style.minHeight = '180px';
                
                const img = document.createElement('img');
                img.src = item.card.image;
                img.alt = item.card.name;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                img.style.width = 'auto';
                img.style.height = 'auto';
                img.style.objectFit = 'contain';
                
                imgContainer.appendChild(img);
                
                // 卡片名稱
                const name = document.createElement('div');
                name.textContent = item.card.name;
                name.style.fontWeight = '600';
                name.style.margin = '5px 0';
                name.style.color = '#333';
                name.style.fontSize = '0.9rem';
                
                // 卡片數量
                const count = document.createElement('div');
                count.textContent = `x${item.count}`;
                count.style.fontWeight = 'bold';
                count.style.color = '#e53935';
                count.style.fontSize = '1rem';
                
                cardElement.appendChild(imgContainer);
                cardElement.appendChild(name);
                cardElement.appendChild(count);
                
                // 添加到當前行
                currentRow.appendChild(cardElement);
                
                // 每4個卡片換行
                if ((index + 1) % cardsPerRow === 0) {
                    cardsGrid.appendChild(currentRow);
                    currentRow = document.createElement('div');
                    currentRow.style.display = 'flex';
                    currentRow.style.width = '100%';
                    currentRow.style.justifyContent = 'space-between';
                    currentRow.style.marginBottom = '15px';
                }
            });
            
            // 添加最後一行（如果不滿4個）
            if (currentRow.children.length > 0) {
                cardsGrid.appendChild(currentRow);
            }
            
            tempContainer.appendChild(cardsGrid);
            
            // 將臨時容器添加到文檔中（隱藏）
            tempContainer.style.position = 'fixed';
            tempContainer.style.left = '-9999px';
            document.body.appendChild(tempContainer);
            
            // 使用html2canvas生成圖片
            html2canvas(tempContainer, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                // 創建下載連結
                const link = document.createElement('a');
                link.download = `排球少年TCG牌組-${new Date().toISOString().slice(0, 10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // 移除臨時容器
                document.body.removeChild(tempContainer);
                
                showNotification('牌組圖片下載完成！', 'success');
            }).catch(error => {
                console.error('生成圖片時出錯:', error);
                document.body.removeChild(tempContainer);
                showNotification('生成圖片時出錯，請重試', 'error');
            });
        }
        
        // 顯示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'warning') {
                notification.classList.add('warning');
            } else if (type === 'error') {
                notification.classList.add('error');
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // 輔助函數：獲取類型文本
        function getTypeText(type) {
            const typeMap = {
                'karasuno': '烏野高校',
                'nekoma': '音駒高校',
                'aoba-johsai': '青葉城西',
                'fukurodani': '梟谷高校',
                'other': '其他高校',
                'event': '事件',
                'hvbp': 'HVBP',
                'hvpr': 'HVPR'
            };
            return typeMap[type] || type;
        }
    </script>
</body>
</html>
